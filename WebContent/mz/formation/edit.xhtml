<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.org/schema/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:plb="http://plb.fr/components" xmlns:a="http://richfaces.org/a4j">

	<s:decorate id="eDecorate"
		template="#{sessionDataManager.managerIntervenantsManager ? (formationManager.creationMode ? 'layout/properties_new.xhtml' : 'layout/properties.xhtml') : 'layout/properties_commercial.xhtml'}">
		<ui:define name="identification">
			<a:outputPanel id="referencePanel">
				<s:decorate template="../layout/edit.xhtml" id="refDecorate">
					<ui:define name="label">#{messages['formation.reference']}</ui:define>
					<h:inputText id="refInput" required="true" size="5"
						value="#{formation.reference}"
						validator="#{formationManager.validateReference}">
						<a:ajax event="change" execute="@this" render="referencePanel"></a:ajax>
					</h:inputText>
				</s:decorate>
			</a:outputPanel>

			<s:decorate template="../layout/edit.xhtml" id="libDecorate">
				<ui:define name="label">#{messages['formation.libelle']}</ui:define>
				<h:inputText id="libInput" required="true" size="80"
					value="#{formation.libelle}">
					<a:ajax event="change" execute="@this" render="baliseTitlePanel"
						listener="#{formationManager.updateBaliseTitle}" />
				</h:inputText>
			</s:decorate>

			<s:decorate template="../layout/edit.xhtml" id="visDecorate">
				<ui:define name="label">#{messages['formation.visible']}</ui:define>
				<h:selectOneMenu value="#{formation.visible}" id="visSelect">
					<f:selectItem itemValue="oui" itemLabel="Oui" />
					<f:selectItem itemValue="non" itemLabel="Non" />
				</h:selectOneMenu>
			</s:decorate>

			<s:decorate template="../layout/edit.xhtml" id="preDecorate">
				<ui:define name="label">#{messages['formation.precision']}</ui:define>
				<h:inputTextarea value="#{formation.precision}" id="preArea" />
			</s:decorate>


			<s:decorate template="../layout/edit.xhtml" id="durDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.duree']}" />
				</ui:define>
				<h:inputText required="true" size="2" value="#{formation.duree}"
					id="durInput">
					<a:ajax event="valueChange" execute="@this" render="prixPanel" />
				</h:inputText>
			</s:decorate>
			<s:decorate rendered="#{!sessionDataManager.commercial}"
				template="../layout/edit.xhtml" id="staDecorate">
				<ui:define name="label">#{messages['formation.statut']}</ui:define>
				<h:inputTextarea value="#{formation.statut}" cols="60" rows="3"
					id="staArea" />
			</s:decorate>
		</ui:define>

		<ui:define name="filieres">

			<s:decorate template="../layout/edit.xhtml" id="catDecorate">
				<ui:define name="label">#{messages['formation.categorie']}</ui:define>
				<h:selectOneMenu required="true" value="#{formation.categorie}"
					id="catSel">
					<a:ajax event="change" render="rangCategoriePanel baliseTitlePanel"
						execute="@this" listener="#{formationManager.updateBaliseTitle}">
					</a:ajax>
					<s:selectItems value="#{categories}" var="categorie"
						label="#{categorie.libelle} (#{categorie.filiere.libelle})"
						noSelectionLabel="Sélectionner une catégorie" />
					<s:convertEntity />
				</h:selectOneMenu>
			</s:decorate>

			<a:outputPanel layout="block" id="rangCategoriePanel">
				<a:outputPanel rendered="#{formation.categorie != null}">
					<s:decorate id="rangCategorieDecoration"
						template="../layout/edit.xhtml">
						<ui:define name="label">#{messages['formation.rangCategorie']}
					
					</ui:define>
						<h:inputText value="#{formation.rangCategorie}" id="rangInput" />
					</s:decorate>
					<div>
						<rich:collapsiblePanel expanded="#{false}" id="autPanel"
							header="Voir les autres formations de la catégorie"
							switchType="client">
							<rich:dataTable
								value="#{formationManager.autresFormationsCategorie()}"
								var="formation">
								<rich:column>
									<f:facet name="header">#{messages['formation.reference']}</f:facet>
									<h:outputLink rendered="#{formation.urlPlb != null}"
										value="#{WEB_URL}#{formation.urlPlb}" target="_blank">#{formation.reference}</h:outputLink>
									<h:outputText rendered="#{formation.urlPlb == null}"
										value="#{formation.reference}" />
								</rich:column>
								<rich:column>
									<f:facet name="header">#{messages['formation.libelle']}</f:facet>
									<h:outputText value="#{formation.libelle}" />
								</rich:column>
								<rich:column>
									<f:facet name="header">#{messages['formation.rangCategorie']}</f:facet>
									<h:outputText value="#{formation.rangCategorie}" />
								</rich:column>
							</rich:dataTable>
						</rich:collapsiblePanel>

					</div>
				</a:outputPanel>
			</a:outputPanel>
			<br />
			<a:commandButton value="Ajouter une formations associée"
				id="addFaButton" render="formationAssocieesPopup">
				<rich:componentControl target="formationAssocieesPopup"
					operation="show" />
			</a:commandButton>

			<rich:dataTable id="formationAssocieesList"
				value="#{formation.formationAssociees}" var="fFormation">
				<rich:column>
					<f:facet name="header">
						#{messages['formation.formationAssociees']}
						</f:facet>
							#{fFormation.libelle}				
					</rich:column>

				<rich:column>
					<f:facet name="header" />
					<a:commandButton value="Supprimer"
						action="#{formationManager.removeFormationAssociee(fFormation)}"
						render="formationAssocieesList,formationSuivantesListes,formationSuivantesListesEdit">
						<s:conversationId />
					</a:commandButton>
				</rich:column>
			</rich:dataTable>
			<br />
			<rich:dataTable id="formationSuivantesListesEdit"
				value="#{formationManager.formationSuivantes}" var="fFormation"
				rendered="#{not empty formationManager.formationSuivantes}">
				<rich:column>
					<f:facet name="header">
						#{messages['formation.formationSuivantes']}
						</f:facet>
							#{fFormation.libelle}				
					</rich:column>
			</rich:dataTable>
<br/>
			<a:commandButton value="Ajouter à une catégorie secondaire"
				id="addFButton" render="formationFiliereContent"
				action="#{formationManager.addNewFormationFiliere}"
				oncomplete="#{rich:component('formationFilierePopup')}.show();">

			</a:commandButton>


			<rich:dataTable id="formationFiliereList"
				value="#{formation.formationFilieres}" var="fFiliere">
				<rich:column>
					<f:facet name="header">
						#{messages['formation.categorie']}
					</f:facet>
					<h:outputText
						value="#{fFiliere.categorie != null ? fFiliere.categorie.libelle :'A définir'}" />
				</rich:column>
				<rich:column>
					<f:facet name="header">
						#{messages['formation.filiere']}
						</f:facet>
					<a:outputPanel>#{fFiliere.libelle}</a:outputPanel>
				</rich:column>
				<rich:column>
					<f:facet name="header">
						#{messages['formation.filiere.rang']}
					</f:facet>
					<h:outputText value="#{fFiliere.rangFiliere}" />
				</rich:column>
				<rich:column>
					<f:facet name="header" />
					<a:commandButton value="Supprimer"
						action="#{formationManager.removeFormationFiliere(fFiliere)}"
						render="formationFiliereList" immediate="true">
						<s:conversationId />
					</a:commandButton>
					&#160;
					<a:commandButton value="Modifier le rang"
						render="formationFiliereContent"
						action="#{formationManager.setNewFormationFiliere(fFiliere)}"
						oncomplete="#{rich:component('formationFilierePopup')}.show();"
						immediate="true">
					</a:commandButton>
				</rich:column>
			</rich:dataTable>



		</ui:define>

		<ui:define name="referencement">

			<s:decorate template="../layout/edit.xhtml" id="mkeyDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.motClePrimaire']}" />
				</ui:define>
				<h:inputText required="true" size="20"
					value="#{formation.motClePrimaire}" id="mkeyInput">
					<a:ajax event="change" render="baliseTitlePanel" execute="@this"
						listener="#{formationManager.updateBaliseTitle}" />
				</h:inputText>
			</s:decorate>

			<s:decorate template="../layout/edit.xhtml" id="urlDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.url']}" />
				</ui:define>
				<h:inputText required="true" size="20" value="#{formation.url}"
					validator="#{formationManager.validateUrl}" id="urlInput" />
			</s:decorate>

			<s:decorate
				rendered="#{sessionDataManager.managerIntervenantsManager}"
				template="../layout/edit.xhtml" id="balDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.baliseKeyWords']}" />
				</ui:define>
				<h:inputTextarea required="true" value="#{formation.baliseKeyWords}"
					cols="60" rows="3" id="balArea" />
			</s:decorate>

			<s:decorate template="../layout/edit.xhtml" id="adDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.campagneAdWords']}" />
				</ui:define>
				<h:inputTextarea value="#{formation.campagneAdWords}" cols="60"
					rows="3" id="adArea" />
			</s:decorate>

			<s:decorate
				rendered="#{sessionDataManager.managerIntervenantsManager}"
				template="../layout/edit.xhtml" id="balDDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.baliseDescription']}" />
				</ui:define>
				<h:inputTextarea value="#{formation.baliseDescription}" cols="60"
					rows="3" id="balDArea" />
			</s:decorate>

			<a:outputPanel id="baliseTitlePanel">
				<s:decorate template="../layout/edit.xhtml" id="balTDecorate">
					<ui:define name="label">
						<h:outputText value="#{messages['formation.baliseTitle']}" />
					</ui:define>
					<h:inputTextarea value="#{formation.baliseTitle}" id="baliseInput"
						cols="60" rows="3" />
				</s:decorate>
			</a:outputPanel>

		</ui:define>
		<ui:define name="commercial">
			<s:decorate template="../layout/edit.xhtml" id="remDecorate">
				<ui:define name="label">#{messages['formation.remarques']}</ui:define>
				<plb:editorRemarques id="remarquesEditor"
					value="#{formation.remarques}" height="80" />
			</s:decorate>

			<a:outputPanel id="prixPanel">
				<s:decorate template="../layout/edit.xhtml"
					rendered="#{formation.duree &lt; 7}" id="tInterDecrorate">
					<ui:define name="label">
						<h:outputText value="#{messages['formation.tarifInter']}" />
					</ui:define>
					<h:selectOneMenu value="#{formation.codeTarifInter}"
						id="tInterSelect">
						<a:ajax event="change" execute="@this" render="prixPanel" />
						<f:selectItem itemValue=""
							itemLabel="#{messages['formation.tarifInter.sans']}" />
						<f:selectItem itemValue="E1" itemLabel="E1" />
						<f:selectItem itemValue="E2" itemLabel="E2" />
						<f:selectItem itemValue="E3" itemLabel="E3" />
						<f:selectItem itemValue="E4" itemLabel="E4" />
						<f:selectItem itemValue="E5" itemLabel="E5" />
						<f:selectItem itemValue="E6" itemLabel="E6" />

					</h:selectOneMenu>
				</s:decorate>


				<s:decorate template="../layout/edit.xhtml" id="prixDecorate">
					<ui:define name="label">
						<h:outputText value="#{messages['formation.prix']}" />
					</ui:define>
					<h:inputText
						rendered="#{empty formation.codeTarifInter or formation.codeTarifInter.equals('E0') or formation.duree &gt; 6}"
						value="#{formation.prix}" id="prixInput" />

					<h:outputText
						rendered="#{!empty formation.codeTarifInter and !formation.codeTarifInter.equals('E0')}"
						value="#{formationManager.prixInter}">
						<f:convertNumber currencySymbol="€" type="currency" locale="FR" />
					</h:outputText>
				</s:decorate>
				<s:decorate template="../layout/edit.xhtml" id="updateTarif"
					rendered="#{formation.hasObsoleteTarif(lastUpdateTarifs)}">
					<ui:define name="label">
						<h:outputText value="#{messages['formation.updateTarif']}" />
					</ui:define>
					<h:selectBooleanCheckbox value="#{formationManager.updateTarif}"
						id="updTarifCheck" />
				</s:decorate>
			</a:outputPanel>

			<s:decorate template="../layout/display.xhtml" id="tIntraDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.tarifIntra']}" />
				</ui:define>
				<h:inputText value="#{formation.libreIntra}" id="tIntraInput" />
			</s:decorate>

			<s:decorate template="../layout/edit.xhtml" id="oriDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.origine']}" />
				</ui:define>
				<h:inputText required="true" size="20" value="#{formation.origine}"
					id="oriInput" />
			</s:decorate>

			<s:decorate template="../layout/edit.xhtml" id="couDecorate">
				<ui:define name="label">
					<h:outputText
						value="#{messages['formation.coursPlbCataloguePartenaire']}" />
				</ui:define>
				<h:inputText size="20"
					value="#{formation.coursPlbCataloguePartenaire}" id="couInput" />
			</s:decorate>

			<s:decorate template="../layout/display.xhtml" id="interDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.plbInter']}" />
				</ui:define>
				<h:selectBooleanCheckbox value="#{formation.plbInter}"
					id="interCheck" />
			</s:decorate>

			<s:decorate template="../layout/display.xhtml" id="supDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.support']}" />
				</ui:define>
				<h:selectBooleanCheckbox value="#{formation.support}" id="supCheck" />
			</s:decorate>
			<s:decorate template="../layout/display.xhtml" id="disDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.distance']}" />
				</ui:define>
				<h:selectOneMenu value="#{formation.distance}" id="disSelect">
					<f:selectItem itemValue="Oui" />
					<f:selectItem itemValue="Non" />
					<f:selectItem itemValue="Partiellement" />
				</h:selectOneMenu>
			</s:decorate>
			<s:decorate template="../layout/display.xhtml" id="cerDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.certification']}" />
				</ui:define>
				<h:inputText value="#{formation.certification}" id="cerInput" />
			</s:decorate>
			<s:decorate template="../layout/display.xhtml" id="offDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.officiel']}" />
				</ui:define>
				<h:inputText value="#{formation.officiel}" id="offInput" />
			</s:decorate>
			<s:decorate template="../layout/display.xhtml" id="nivDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.niveau']}" />
				</ui:define>
				<h:selectOneMenu value="#{formation.niveau}" id="nivSelect">
					<f:selectItem itemValue="Débutant" />
					<f:selectItem itemValue="Intermédiaire" />
					<f:selectItem itemValue="Expert" />
				</h:selectOneMenu>
			</s:decorate>
			<s:decorate template="../layout/display.xhtml">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.eligibleCpf']}"
						id="eliDecorate" />
				</ui:define>
				<h:selectBooleanCheckbox value="#{formation.eligibleCpf}"
					id="eliCheck" />
			</s:decorate>
			<s:decorate template="../layout/display.xhtml">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.codeCpf']}"
						id="cpfDecorate" />
				</ui:define>
				<h:inputText value="#{formation.codeCpf}" id="cpfCheck" />
			</s:decorate>
			<s:decorate template="../layout/display.xhtml" id="eleDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.elearning']}" />
				</ui:define>
				<h:selectBooleanCheckbox value="#{formation.elearning}"
					id="eleCheck" />
			</s:decorate>
			<s:decorate template="../layout/edit.xhtml" id="argDecorate">
				<ui:define name="label">#{messages['formation.argumentaire']}</ui:define>
				<h:inputTextarea value="#{formation.argumentaire}" cols="100"
					rows="8" id="argArea" />
			</s:decorate>
		</ui:define>
		<ui:define name="mutualisees">
			<a:commandButton value="Modifier les formation mutualisee"
				render="formationMutualiseesPopup">
				<rich:componentControl target="formationMutualiseesPopup"
					operation="show" />
			</a:commandButton>
			<a:outputPanel id="formationMutualiseesList">
				<rich:dataTable rendered="#{formation.formationMutualisees != null}"
					value="#{formation.formationMutualisees.formations}"
					var="formation">
					<rich:column>
						<f:facet name="header">#{messages['formation.reference']}</f:facet>
						<h:outputText value="#{formation.reference}" />
					</rich:column>
					<rich:column>
						<f:facet name="header">#{messages['formation.libelle']}</f:facet>
						<h:outputText value="#{formation.libelle}" />
					</rich:column>
					<rich:column>
						<f:facet name="header" />
						<a:commandButton value="Enlever"
							action="#{formationManager.removeFormationMutualisee(formation)}"
							render="formationMutualiseesList">
							<s:conversationId />
						</a:commandButton>
					</rich:column>
				</rich:dataTable>
			</a:outputPanel>
		</ui:define>
		<ui:define name="partenaires">
			<s:decorate template="../layout/display.xhtml" id="typDecorate">
				<ui:define name="label">
					<h:outputText value="#{messages['formation.type']}" />
				</ui:define>
				<h:selectOneRadio value="#{formation.type}" id="typeRadio">
					<f:selectItem itemValue="rouge" itemLabel="Rouge" />
					<f:selectItem itemValue="gris" itemLabel="Gris" />
					<f:selectItem itemValue="blanc" itemLabel="Blanc" />
				</h:selectOneRadio>
			</s:decorate>


			<a:commandButton value="Ajouter une formation partenaire"
				execute="@form" render="formationPartenairePanel"
				oncomplete="#{rich:component('formationPartenairePopup')}.show();">
				<s:conversationId />
			</a:commandButton>


			<rich:dataTable id="formationPartenaireList"
				value="#{formation.formationsPartenaire}" var="fPartenaire">
				<rich:column>
					<f:facet name="header">
						#{messages['partenaire.nom']}
						</f:facet>
							#{fPartenaire.partenaire.nom}				
					</rich:column>
				<rich:column>
					<f:facet name="header">
						#{messages['partenaire.remise']}
						</f:facet>
							#{fPartenaire.partenaire.remise}				
					</rich:column>
				<rich:column>
					<f:facet name="header">
						#{messages['formationPartenaire.code']}
					</f:facet>
					<h:inputText value="#{fPartenaire.code}" id="fPatCode" />
				</rich:column>
				<rich:column>
					<f:facet name="header">
						#{messages['formationPartenaire.prix']}
					</f:facet>
					<h:inputText value="#{fPartenaire.prix}" id="fPatPrix" />
				</rich:column>
				<rich:column>
					<f:facet name="header">
						#{messages['formationPartenaire.url']}
					</f:facet>
					<h:inputText value="#{fPartenaire.url}" id="fPatUrl" />
				</rich:column>
				<rich:column>
					<f:facet name="header" />
					<a:commandButton value="Supprimer" execute="@this"
						action="#{formationManager.removeFormationPartenaire(fPartenaire)}"
						render="formationPartenaireList,sessionsPanel">
						<s:conversationId />
					</a:commandButton>
				</rich:column>
			</rich:dataTable>
		</ui:define>
		<ui:define name="buttons">
			<ui:include src="_editButtons.xhtml" />
		</ui:define>
	</s:decorate>

</ui:composition>
